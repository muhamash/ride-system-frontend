import{r,J as X,j as e,K as b,N as z,X as Z,Q as E,S as I,T as U,U as M,x as ee,z as se,V as te,W as ae,Y as ne,B as re,G as S,a as D,Z as ie,_ as B,$ as ce,a0 as le}from"./index-BoU8ccGb.js";import{u as oe}from"./useGeolocation-CBLuctmM.js";import{N as de,S as ue,U as me}from"./switch-DEIq3FbY.js";function q(t,i){const a=i==="premium"?50:30,o=i==="premium"?18:12;return a+t/1e3*o}function xe(t,i){const[a,o]=r.useState(t);return r.useEffect(()=>{const l=setTimeout(()=>{o(t)},i);return()=>{clearTimeout(l)}},[t,i]),a}function V({id:t,label:i,value:a,onChange:o,onLocationSelect:l,locations:m=[],icon:d,inputRef:T}){const[L,w]=r.useState(!1),[p,y]=r.useState(m),x=xe(a,500),[R]=X(),c=r.useRef(null);r.useEffect(()=>{(async()=>{if(!x){y(m);return}try{const f=await R({query_text:x}).unwrap();if(f?.statusCode===200&&Array.isArray(f.data)){const k=f.data.map(j=>({id:j.place_id,name:j.address_line1,address:j.address_line2,coords:{lat:j.lat,lng:j.lon}}));y(k)}else y([])}catch{y([])}})()},[x,R,m]),r.useEffect(()=>{const s=f=>{c.current&&!c.current.contains(f.target)&&w(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const g=s=>{l(s),w(!1)};return e.jsxs("div",{className:"space-y-2 relative",ref:c,children:[e.jsxs(b,{htmlFor:t,className:"flex items-center gap-2",children:[d,i]}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{id:t,placeholder:`Enter ${i.toLowerCase()}`,value:a,onChange:s=>o(s.target.value),onFocus:()=>w(!0),className:"pr-8"}),a&&e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",onClick:()=>{o(""),l(null)},children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx("div",{className:`absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto transition-all duration-300 ease-in-out
                        ${L?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,children:p.length>0?p.map(s=>e.jsxs("div",{className:"px-4 py-3 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>g(s),children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-gray-600",children:s.address})]},s.id)):e.jsx("div",{className:"px-4 py-3 text-gray-500",children:"No locations found"})})]})]})}function he({pickupLocation:t,destination:i,rideType:a,paymentMethod:o,rideData:l,rideOptions:m}){return console.log(l?.fare[a],a),e.jsxs(E,{className:"shadow-lg",children:[e.jsx(I,{className:"pb-3",children:e.jsx(U,{children:"Ride Summary"})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"From:"}),e.jsx("span",{className:"font-medium",children:t||"Not selected"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"To:"}),e.jsx("span",{className:"font-medium",children:i||"Not selected"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Ride Type:"}),e.jsx("span",{className:"font-medium",children:m.find(d=>d.id===a)?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment:"}),e.jsx("span",{className:"font-medium capitalize",children:o})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Estimated Price:"}),e.jsxs("span",{className:"text-blue-600",children:[l?.fare?l?.fare[a].toFixed(2):m.find(d=>d.id===a)?.price," ","Tk"]})]}),e.jsx("p",{className:"text-purple-600 font-mono",children:"Disclaimer: This price is just a show off! it has not any value! i am calculating mock pricing range!"})]})]})})]})}function pe({option:t,isSelected:i,rideTypesData:a,onSelect:o}){return e.jsx(E,{className:`cursor-pointer transition-all ${i?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>o(t.id),children:e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.icon,e.jsx("span",{className:"font-medium",children:t.name})]}),i&&e.jsx("div",{className:"h-3 w-3 rounded-full bg-blue-500"})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("div",{children:a?.fare?`Fare: à§³${a.fare[t.id].toFixed(2)}`:t.price}),e.jsxs("div",{children:["ETA: ",a?.duration?(()=>{const l=Math.round(a.duration),m=Math.floor(l/60),d=l%60;return`${m} min ${d} sec`})():t.eta]})]})]})})}const _=[{id:"standard",name:"standard",price:"12-15 tk",eta:"5 min",icon:e.jsx(B,{className:"h-5 w-5"})},{id:"premium",name:"premium",price:"18-22 tk",eta:"8 min",icon:e.jsx(me,{className:"h-5 w-5"})}];function ve(){const[t,i]=r.useState(""),[a,o]=r.useState(""),[l,m]=r.useState("standard"),[d,T]=r.useState("card"),{data:L}=ee(),w=L?.data?._id||"",{coords:p,retry:y}=oe(w),[x,R]=r.useState(!0),[c,g]=r.useState(null),[s,f]=r.useState(null),[k,j]=r.useState(),N=r.useRef(null),O=r.useRef(null),A=r.useRef(null),C=r.useRef(null);se();const[$,{data:fe,isLoading:G,error:ge}]=te(),{showToast:Q,updateToast:F}=le(),{data:Y}=ae(),[K]=ne();r.useEffect(()=>{x&&p&&(i(p.address),g({lat:p.lat,lng:p.lng}))},[x,p]),r.useEffect(()=>{(async()=>{if(!c||!s)return;const h=`${c.lng},${c.lat};${s.lng},${s.lat}`;try{const u=await $({profile:"driving",coordinates:h,steps:!0,overview:"full"}).unwrap();console.log("Route data:",u.data.routes),C.current={distance:u.data.routes[0].distance,duration:u.data.routes[0].duration,fare:{standard:q(u.data.routes[0].distance,"standard"),premium:q(u.data.routes[0].distance,"premium")}},j(u)}catch(u){console.error("Error fetching route:",u)}})()},[c,s,$]);const P=(n,h)=>{if(!n){h?(g(null),i("")):(f(null),o(""));return}h?(i(n.name),g(n.coords)):(o(n.name),f(n.coords))},H=()=>{const n=t,h=c;i(a),g(s),o(n),f(h)},J=re(),W=async n=>{if(n.preventDefault(),!s){alert("Please select valid pickup and destination locations");return}const h={fare:C.current.fare[l].toFixed(2),lat:s.lat,lng:s.lng,picLat:c?.lat,picLng:c?.lng},u=Q({type:"loading",message:"Requesting a ride!"});try{const v=await K({payload:h}).unwrap();console.log(v),F(u,{type:"success",message:v?.message}),console.log(h),J(`/ride/ride-info/${v?.data?.ride?._id}`)}catch(v){F(u,{type:"error",message:v?.message||v?.data?.message})}console.log(h)};return r.useEffect(()=>{if(c&&s&&N.current){const n=[c,s];N.current.fitBounds(n,{padding:[50,50]})}else c&&N.current?N.current.setView(c,13):s&&N.current&&N.current.setView(s,13)},[c,s]),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-30 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Book Your Ride"}),e.jsx("p",{className:"text-gray-600",children:"Enter your details and we'll find you the perfect ride"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs(E,{className:"p-6 shadow-lg",children:[e.jsxs(I,{className:"p-0 pb-6",children:[e.jsxs(U,{className:"text-2xl flex items-center gap-2",children:[e.jsx(de,{className:"h-6 w-6 text-blue-600"}),"Ride Details"]}),!p&&x&&e.jsx("p",{className:"text-sm text-pink-400 font-mono py-5 leading-tight",children:"NOTE : You have not permitted your device location to the app! Or maybe you are location is not supported for the reverse geo api!! Please allow location or give permission to the website!! for better result reload the page after permitted the location service!! else you better enter manually coord/location info at the input box!!"})]}),e.jsx(M,{className:"p-0",children:e.jsxs("form",{onSubmit:W,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(b,{className:"text-lg",children:"Pickup Mode:"}),e.jsxs("div",{className:"flex flex-wrap items-center space-x-2",children:[e.jsx(S,{type:"button",variant:x?"default":"outline",onClick:()=>{y(),R(!0),window.location.reload()},children:"Use Current Location"}),e.jsx(S,{type:"button",variant:x?"outline":"default",onClick:()=>{R(!1),i(""),g()},children:"Search Manually"})]})]}),e.jsxs("div",{className:"space-y-4",children:[x?e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-blue-600"}),"Pickup Location (Current)"]}),e.jsx(z,{value:t,readOnly:!0,className:"bg-gray-100 cursor-not-allowed"})]}):e.jsx(V,{id:"pickup",label:"Pickup Location",value:t,onChange:i,onLocationSelect:n=>P(n,!0),locations:[],icon:e.jsx(D,{className:"h-4 w-4 text-blue-600"}),inputRef:O}),e.jsx(S,{type:"button",variant:"outline",size:"icon",className:"mx-auto flex rounded-full",onClick:H,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx(V,{id:"destination",label:"Destination",value:a,onChange:o,onLocationSelect:n=>P(n,!1),locations:[],icon:e.jsx(D,{className:"h-4 w-4 text-red-600"}),inputRef:A})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{className:"text-lg",children:"Choose Ride Type"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:_.map(n=>e.jsx(pe,{option:n,isSelected:l===n.id,onSelect:m,rideTypesData:C.current},n.id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(b,{className:"text-lg flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"Payment Method"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ue,{id:"payment-method",checked:d==="card",onCheckedChange:n=>T(n?"card":"cash")}),e.jsx(b,{htmlFor:"payment-method",className:"cursor-pointer",children:d==="card"?"Credit Card":"Cash"})]})]}),e.jsxs(S,{type:"submit",className:"w-full",size:"lg",disabled:!s||!c,children:[e.jsx(B,{className:"mr-2 h-5 w-5"})," Request Ride Now"]})]})})]}),e.jsxs("div",{className:"space-y-6",children:[G&&e.jsx("p",{children:"Loading..."}),e.jsx(ce,{pickupLocation:t,destination:a,pickupCoords:c,destinationCoords:s,mapRef:N,routeData:[k?.data],onlineDrivers:Y?.data}),e.jsx(he,{pickupLocation:t,destination:a,rideType:l,paymentMethod:d,rideOptions:_,rideData:C.current})]})]})]})})}export{ve as default};
