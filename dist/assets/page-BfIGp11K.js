import{c as w,j as e,G as A,x as B,a2 as U,a3 as b,a4 as P,a5 as k,B as O,z as T,r as d,Q as q,S as G,T as M,a6 as E,U as _,a0 as F,a7 as j}from"./index-E7vdas5E.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}]],Q=w("badge",Y);function z({driverData:t,driverStatus:i,toggleAvailability:l}){return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("p",{children:["Name: ",t?.data?.name]}),e.jsxs("p",{children:["Email: ",t?.data?.email]}),e.jsxs("p",{children:["Driver Status: ",i]}),e.jsxs("p",{children:["User Status: ",t?.data?.isOnline?"ONLINE":"OFFLINE"]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("span",{children:"Status: "}),e.jsx(A,{variant:i===a.AVAILABLE?"default":"outline",onClick:l,disabled:[a.NOTAPPROVED,a.RIDING,a.SUSPENDED].includes(i),children:i===a.AVAILABLE?"Available":"Unavailable"})]})]})}function H({ride:t,onAccept:i,onCancel:l}){return e.jsxs("div",{className:"flex justify-between items-center p-4 border rounded-lg shadow-sm bg-white",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:t.passengerName}),e.jsxs("p",{className:"text-sm text-gray-700",children:[t.pickup," ",e.jsx("span",{className:"text-xl text-rose-700 px-2",children:"→"})," ",t.dropoff]}),e.jsxs("p",{className:"text-sm",children:["Fare: ৳",t.fare]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{variant:"secondary",children:t.status}),e.jsx(A,{onClick:()=>i(t.id),children:"Accept"}),e.jsx(A,{variant:"destructive",onClick:()=>l(t.id),children:"Cancel"})]})]})}const a={AVAILABLE:"AVAILABLE",UNAVAILABLE:"UNAVAILABLE",SUSPENDED:"SUSPENDED",RIDING:"RIDING",APPROVED:"APPROVED",NOTAPPROVED:"UNDER_REVIEW"};function W(){const{data:t,isLoading:i}=B(),[l]=U(),[I]=b(),[L]=P(),[D]=k(),y=O(),N=T(),{showToast:o}=F(),[c,u]=d.useState(),[R,p]=d.useState([]),[x,m]=d.useState(null),[v,g]=d.useState(null);d.useEffect(()=>{t?.data?.driver?.driverStatus&&u(t.data.driver.driverStatus)},[t]);const h=d.useCallback(async()=>{if(c!==a.AVAILABLE){p([]);return}try{m(null);const s=await l().unwrap(),r=s?.data?.rides||[];console.log(r);const f=r.map(n=>({id:n.id,passengerName:n.riderUserName,pickup:n.pickUpLocation.address,dropoff:n.dropOffLocation.address,fare:n.fare,status:n.status,distance:n.distanceInKm}));p(f.filter(n=>n.status==="REQUESTED")),g(s?.data?.currentRide?._id||null)}catch(s){s?.status===403?(u(a.RIDING),m(s?.data?.message||"You are currently on an ongoing ride.")):m(s?.data?.message||"Failed to fetch ride requests."),p([])}},[l,c]);d.useEffect(()=>{h()},[c,h]);const S=async()=>{if(![a.NOTAPPROVED,a.RIDING,a.SUSPENDED].includes(c))try{const s=await I().unwrap();o({message:"Driver status updated successfully!",type:"success"});const r=s?.data?.driverStatus??(c===a.AVAILABLE?a.UNAVAILABLE:a.AVAILABLE);u(r),r===a.AVAILABLE&&h()}catch(s){o({message:s?.data?.message||s.message,type:"error"})}finally{N(j.util.resetApiState())}},V=async s=>{try{const r=await L({id:s}).unwrap();o({type:"success",message:r?.data?.data?.message||"Ride accepted successfully!"}),u(a.RIDING),g(r?.data?.data?.acceptedRide?._id||null),y(`/ride/ride-info/${r?.data?.acceptedRide?._id}`)}catch(r){o({type:"error",message:r?.data?.message||r.message})}},C=async s=>{await D({id:s}),N(j.util.resetApiState()),o({type:"success",message:"Cancelled request!"}),p(r=>r.filter(f=>f.id!==s))};return i?e.jsx("p",{children:"Loading..."}):e.jsx("div",{className:"container mx-auto p-6 py-30",children:e.jsxs(q,{className:"shadow-md rounded-2xl",children:[e.jsxs(G,{className:"flex justify-between items-center",children:[e.jsx(M,{className:"text-2xl font-bold",children:"Driver Dashboard"}),e.jsx(A,{onClick:()=>window.location.reload(),variant:"outline",size:"sm",children:"Refresh"})]}),e.jsx(E,{}),e.jsxs(_,{className:"space-y-4 mt-4",children:[t&&e.jsx(z,{driverData:t,driverStatus:c,toggleAvailability:S}),e.jsx(E,{}),x&&e.jsx("p",{className:"text-red-500",children:x}),c===a.AVAILABLE&&R.length===0&&!x&&e.jsx("p",{className:"text-gray-500",children:"You are online and available. Please wait for a ride request..."}),c===a.AVAILABLE&&R.map(s=>e.jsx(H,{ride:s,onAccept:V,onCancel:C},s.id)),(c===a.RIDING||v)&&e.jsx("p",{className:"text-red-500",children:"You are currently riding!"}),c===a.UNAVAILABLE&&!x&&e.jsx("p",{className:"text-red-500",children:"You are currently unavailable. Toggle to Available to see ride requests."})]})]})})}export{a as DRIVER_STATUS,W as default};
