import{c as b,r as N,j as e,P as L,B as D,Z as P,_ as S,$ as A,a0 as v,F as w,W as T,y as E,a1 as I,a2 as U,a3 as M,K as $,N as _,Q as O,a4 as k,S as q,a5 as C}from"./index-DGVUP1Vm.js";import{B}from"./badge-DBNqoGck.js";import{S as j}from"./separator-yiYEwLkb.js";import{a as F,R as V,l as K}from"./RideMap-Dn0xZy_Z.js";import{u as G}from"./hooks-BDlyH-v8.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],Q=b("flag",H);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],W=b("share-2",z);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],Z=b("truck",X);function J(){const t="+880123456789",[n,a]=N.useState(!1),c=()=>{window.location.href=`tel:${t}`},m=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(h=>{const{latitude:l,longitude:u}=h.coords,p=`My location: https://www.google.com/maps?q=${l},${u}`;navigator.share?navigator.share({text:p}):alert("Share this link: "+p)}):alert("Geolocation not supported by your browser")};return e.jsxs("div",{className:"fixed bottom-6 right-6 z-50 flex flex-col items-end space-y-3",children:[n&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:m,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-full shadow-lg transition-all duration-200",children:[e.jsx(W,{className:"h-5 w-5"}),"Share Location"]}),e.jsxs("button",{onClick:c,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded-full shadow-lg transition-all duration-200",children:[e.jsx(L,{className:"h-5 w-5"}),"Emergency"]})]}),e.jsx("button",{onClick:()=>a(!n),className:"flex items-center justify-center bg-yellow-500 hover:bg-green-700 text-white h-12 w-12 rounded-full shadow-lg transition-all duration-200",children:n?"X":"sos"})]})}const d=[{label:"Accepted",key:"ACCEPTED",icon:e.jsx(Q,{className:"w-5 h-5"})},{label:"Picked Up",key:"PICKED_UP",icon:e.jsx(v,{className:"w-5 h-5"})},{label:"In Transit",key:"IN_TRANSIT",icon:e.jsx(Z,{className:"w-5 h-5"})},{label:"Completed",key:"COMPLETED",icon:e.jsx(v,{className:"w-5 h-5"})}],R=t=>{const n=d.findIndex(a=>a.key===t);return t==="COMPLETED"?d.length-1:n};function Y({ride:t,onRideUpdate:n}){const[a,c]=N.useState(R(t.status));console.log(t.status),N.useEffect(()=>{c(R(t.status))},[t.status]);const m=D();console.log(t);const[h]=P(),[l]=S(),[u]=A(),{showToast:p,updateToast:g}=T(),f=async()=>{const o=d[a].key,s=p({type:"info",message:`Processing "${d[a].label}"...`});try{if(o==="ACCEPTED"){const r=await h({id:t._id}).unwrap();console.log(r)}else o==="PICKED_UP"?await l({id:t._id}).unwrap():o==="IN_TRANSIT"&&await u({id:t._id}).unwrap();c(a+1),n?.(),g(s,{type:"success",message:`"${d[a].label}" completed successfully!`}),a===d.length-1&&m("/ride/check-ride-request")}catch(r){console.error("API error:",r);const x=r?.data?.message||r?.message||"Something went wrong!";g(s,{type:"error",message:x})}},y=o=>t.status==="COMPLETED"&&(o<d.length-1||o===d.length-1)||o<a?"completed":o===a?"current":"upcoming";return e.jsxs("div",{className:"p-6 border rounded-lg w-full bg-white shadow-lg",children:[e.jsx("h2",{className:"text-xl font-bold mb-6 text-center",children:"Ride Progress"}),e.jsx("div",{className:"flex justify-between items-center mb-8 relative",children:d.map((o,s)=>{const r=y(s);return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full ${r==="completed"?"bg-green-500 text-white":r==="current"?"bg-blue-600 text-white ring-4 ring-blue-100":"bg-gray-200 text-gray-600"}`,children:r==="completed"?e.jsx(v,{className:"w-5 h-5"}):o.icon}),e.jsx("div",{className:`text-xs mt-2 font-medium ${r==="completed"||r==="current"?"text-gray-900":"text-gray-500"}`,children:o.label})]},o.key)})}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Driver Assigned"}),e.jsx("span",{className:"text-sm font-medium",children:t.driverUserName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Vehicle"}),e.jsx("span",{className:"text-sm font-medium",children:t.driver.vehicleInfo?`${t.driver.vehicleInfo.model} (${t.driver.vehicleInfo.plateNumber})`:"Not Assigned"})]})]}),t.status!=="COMPLETED"&&a<d.length-1&&e.jsx(w,{className:"w-full py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition",onClick:f,children:a===d.length-2?"Take cash!":"Next Step"})]})}function ee({ride:t}){const[n,{isLoading:a}]=F(),[c,m]=N.useState({driveToPickUp:null,drivePickUpToDrop:null}),h=N.useRef(null),l=f=>[f[1],f[0]];if(N.useEffect(()=>{(async()=>{if(!t)return;const y=l(t.driverLocation.coordinates),o=l(t.pickUpLocation.coordinates),s=l(t.dropOffLocation.coordinates),r=(x,i)=>({profile:"driving",coordinates:`${x[1]},${x[0]};${i[1]},${i[0]}`,alternatives:!1,steps:!0,overview:"full"});try{const x=await n(r(y,o)).unwrap(),i=await n(r(o,[s[1],s[0]])).unwrap();m({driveToPickUp:x.data,drivePickUpToDrop:i.data})}catch(x){console.error("Error fetching routes:",x)}})()},[t,n]),a)return e.jsx("p",{children:"Loading route..."});if(!c.driveToPickUp||!c.drivePickUpToDrop)return null;const u=l(t.driverLocation.coordinates),p=l(t.pickUpLocation.coordinates),g=l(t.dropOffLocation.coordinates);return e.jsx(V,{pickupLocation:t.pickUpLocation.address,destination:t.dropOffLocation.address,pickupCoords:p,destinationCoords:[g[1],g[0]],mapRef:h,routeData:[c.driveToPickUp,c.drivePickUpToDrop],acceptDriverCords:u})}function ne(){const{data:t,isLoading:n}=E(),[a]=I(),{id:c}=U(),{data:m,isLoading:h,refetch:l}=M({id:c}),u=t?.data?.role,p=G(),g=()=>{p(C.util.resetApiState()),p(K.util.resetApiState()),window.location.reload()},f=D(),{showToast:y}=T(),o=async()=>{const x=s?._id;try{console.log(x);const i=await a({id:c});if(console.log(i),!i.data){y({type:"info",message:i?.error?.data?.message||"Something wrong in there!"});return}p(C.util.resetApiState()),y({type:"success",message:i.data?.message}),f("/ride/ride-info")}catch(i){y({type:"error",message:i?.message||i?.error?.message||i?.data?.message||"Something went wrong!"})}},s=m?.data;if(n||h)return e.jsx("p",{className:"py-3 text-center",children:"Loading..."});if(!s)return e.jsx("p",{className:"py-30 flex items-center justify-center text-4xl text-red-600",children:"No ride in the database"});const r=s.pickUpLocation?.coordinates?.length===2&&s.dropOffLocation?.coordinates?.length===2;return e.jsx("div",{className:"max-w-3xl mx-auto space-y-6 py-30",children:e.jsxs($,{children:[e.jsxs(_,{children:[e.jsxs(O,{className:"text-2xl font-bold",children:["Ride Details",e.jsx(B,{className:`ml-3 ${s.status==="ACCEPTED"?"bg-green-500":s.status==="PENDING"?"bg-yellow-500":"bg-gray-500"}`,children:s.status})]}),e.jsx(w,{onClick:g,variant:"secondary",size:"sm",className:"w-[100px] bg-purple-200",children:"Refresh"}),e.jsx("p",{className:"text-sm text-blue-600 font-mono py-3",children:"Note: If you don't see any map with your (routes!) accept loading(?) don't panic! just refresh the button please!!! I am using free apis from (geoApify) "}),u!==k.DRIVER&&s.status==="REQUESTED"&&e.jsx(w,{onClick:o,variant:"destructive",children:"Cancel the ride!"})]}),e.jsxs(q,{className:"space-y-4",children:[e.jsx(J,{}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:"Rider"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.rider?.name," (",s.rider?.email,")"]})]}),e.jsx(j,{}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:"Driver"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.driverUserName||"Not Assigned"})]}),e.jsx(j,{}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:"Pickup Location"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.pickUpLocation?.address})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:"Drop-off Location"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.dropOffLocation?.address})]}),e.jsx(j,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:"Distance"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.distanceInKm," km"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:"Fare"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["à§³",s.fare]})]})]}),e.jsx(j,{}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:"Requested At"}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date(s.requestedAt).toLocaleString()})]}),s.acceptedAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:"Accepted At"}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date(s.acceptedAt).toLocaleString()})]}),e.jsx(j,{}),u===k.DRIVER&&e.jsx(Y,{ride:s,onRideUpdate:l}),e.jsx(j,{}),r&&e.jsx(ee,{ride:s})]})]})})}export{ne as default};
