import{r,j as e,I as b,J as U,X as Y,K as D,N as _,Q as z,S as E,y as Z,T as ee,B as se,F as S,a as k,U as ae,V as B,W as te}from"./index-DGVUP1Vm.js";import{u as ne}from"./useGeolocation-blF9OorT.js";import{N as re,S as ie,U as ce}from"./switch-DJ-JUsrT.js";import{u as le,a as oe,b as de,R as ue}from"./RideMap-Dn0xZy_Z.js";import{u as me}from"./hooks-BDlyH-v8.js";function q(a,i){const t=i==="premium"?50:30,o=i==="premium"?18:12;return t+a/1e3*o}function xe(a,i){const[t,o]=r.useState(a);return r.useEffect(()=>{const l=setTimeout(()=>{o(a)},i);return()=>{clearTimeout(l)}},[a,i]),t}function I({id:a,label:i,value:t,onChange:o,onLocationSelect:l,locations:m=[],icon:d,inputRef:M}){const[L,w]=r.useState(!1),[g,y]=r.useState(m),x=xe(t,500),[R]=le(),c=r.useRef(null);r.useEffect(()=>{(async()=>{if(!x){y(m);return}try{const h=await R({query_text:x}).unwrap();if(h?.statusCode===200&&Array.isArray(h.data)){const p=h.data.map(N=>({id:N.place_id,name:N.address_line1,address:N.address_line2,coords:{lat:N.lat,lng:N.lon}}));y(p)}else y([])}catch{y([])}})()},[x,R,m]),r.useEffect(()=>{const s=h=>{c.current&&!c.current.contains(h.target)&&w(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const j=s=>{l(s),w(!1)};return e.jsxs("div",{className:"space-y-2 relative",ref:c,children:[e.jsxs(b,{htmlFor:a,className:"flex items-center gap-2",children:[d,i]}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{id:a,placeholder:`Enter ${i.toLowerCase()}`,value:t,onChange:s=>o(s.target.value),onFocus:()=>w(!0),className:"pr-8"}),t&&e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",onClick:()=>{o(""),l(null)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx("div",{className:`absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto transition-all duration-300 ease-in-out
                        ${L?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,children:g.length>0?g.map(s=>e.jsxs("div",{className:"px-4 py-3 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>j(s),children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-gray-600",children:s.address})]},s.id)):e.jsx("div",{className:"px-4 py-3 text-gray-500",children:"No locations found"})})]})]})}function he({pickupLocation:a,destination:i,rideType:t,paymentMethod:o,rideData:l,rideOptions:m}){return console.log(l?.fare[t],t),e.jsxs(D,{className:"shadow-lg",children:[e.jsx(_,{className:"pb-3",children:e.jsx(z,{children:"Ride Summary"})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"From:"}),e.jsx("span",{className:"font-medium",children:a||"Not selected"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"To:"}),e.jsx("span",{className:"font-medium",children:i||"Not selected"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Ride Type:"}),e.jsx("span",{className:"font-medium",children:m.find(d=>d.id===t)?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment:"}),e.jsx("span",{className:"font-medium capitalize",children:o})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Estimated Price:"}),e.jsxs("span",{className:"text-blue-600",children:[l?.fare?l?.fare[t].toFixed(2):m.find(d=>d.id===t)?.price," ","Tk"]})]}),e.jsx("p",{className:"text-purple-600 font-mono",children:"Disclaimer: This price is just a show off! it has not any value! i am calculating mock pricing range!"})]})]})})]})}function pe({option:a,isSelected:i,rideTypesData:t,onSelect:o}){return e.jsx(D,{className:`cursor-pointer transition-all ${i?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>o(a.id),children:e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.icon,e.jsx("span",{className:"font-medium",children:a.name})]}),i&&e.jsx("div",{className:"h-3 w-3 rounded-full bg-blue-500"})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("div",{children:t?.fare?`Fare: à§³${t.fare[a.id].toFixed(2)}`:a.price}),e.jsxs("div",{children:["ETA: ",t?.duration?(()=>{const l=Math.round(t.duration),m=Math.floor(l/60),d=l%60;return`${m} min ${d} sec`})():a.eta]})]})]})})}const V=[{id:"standard",name:"standard",price:"12-15 tk",eta:"5 min",icon:e.jsx(B,{className:"h-5 w-5"})},{id:"premium",name:"premium",price:"18-22 tk",eta:"8 min",icon:e.jsx(ce,{className:"h-5 w-5"})}];function we(){const[a,i]=r.useState(""),[t,o]=r.useState(""),[l,m]=r.useState("standard"),[d,M]=r.useState("card"),{data:L}=Z(),w=L?.data?._id||"",{coords:g,retry:y}=ne(w),[x,R]=r.useState(!0),[c,j]=r.useState(null),[s,h]=r.useState(null),p=r.useRef(null),N=r.useRef(null),A=r.useRef(null),[O,Q]=r.useState();me();const[F,{data:fe,isLoading:G,error:ge}]=oe(),{showToast:K,updateToast:T}=te(),{data:$}=de(),[H]=ee();console.log($?.data);const C=r.useRef(null);r.useEffect(()=>{x&&g&&(i(g.address),j({lat:g.lat,lng:g.lng}))},[x,g]),r.useEffect(()=>{(async()=>{if(!c||!s)return;const f=`${c.lng},${c.lat};${s.lng},${s.lat}`;try{const u=await F({profile:"driving",coordinates:f,steps:!0,overview:"full"}).unwrap();console.log("Route data:",u.data.routes),C.current={distance:u.data.routes[0].distance,duration:u.data.routes[0].duration,fare:{standard:q(u.data.routes[0].distance,"standard"),premium:q(u.data.routes[0].distance,"premium")}},Q(u)}catch(u){console.error("Error fetching route:",u)}})()},[c,s,F]);const P=(n,f)=>{if(!n){f?(j(null),i("")):(h(null),o(""));return}f?(i(n.name),j(n.coords)):(o(n.name),h(n.coords))},J=()=>{const n=a,f=c;i(t),j(s),o(n),h(f)},W=se(),X=async n=>{if(n.preventDefault(),!s){alert("Please select valid pickup and destination locations");return}const f={fare:C.current.fare[l].toFixed(2),lat:s.lat,lng:s.lng,picLat:c?.lat,picLng:c.lng},u=K({type:"loading",message:"Requesting a ride!"});try{const v=await H({payload:f}).unwrap();console.log(v),T(u,{type:"success",message:v?.message}),W(`/ride/ride-info/${v?.data?.ride?._id}`)}catch(v){T(u,{type:"error",message:v?.message||v?.data?.message})}console.log(f)};return r.useEffect(()=>{if(c&&s&&p.current){const n=[c,s];p.current.fitBounds(n,{padding:[50,50]})}else c&&p.current?p.current.setView(c,13):s&&p.current&&p.current.setView(s,13)},[c,s]),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-30 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Book Your Ride"}),e.jsx("p",{className:"text-gray-600",children:"Enter your details and we'll find you the perfect ride"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs(D,{className:"p-6 shadow-lg",children:[e.jsx(_,{className:"p-0 pb-6",children:e.jsxs(z,{className:"text-2xl flex items-center gap-2",children:[e.jsx(re,{className:"h-6 w-6 text-blue-600"}),"Ride Details"]})}),e.jsx(E,{className:"p-0",children:e.jsxs("form",{onSubmit:X,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(b,{className:"text-lg",children:"Pickup Mode:"}),e.jsxs("div",{className:"flex flex-wrap items-center space-x-2",children:[e.jsx(S,{type:"button",variant:x?"default":"outline",onClick:()=>{y(),R(!0),window.location.reload()},children:"Use Current Location"}),e.jsx(S,{type:"button",variant:x?"outline":"default",onClick:()=>{R(!1),i(""),j({lat:"",lng:""})},children:"Search Manually"})]})]}),e.jsxs("div",{className:"space-y-4",children:[x?e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-blue-600"}),"Pickup Location (Current)"]}),e.jsx(U,{value:a,readOnly:!0,className:"bg-gray-100 cursor-not-allowed"})]}):e.jsx(I,{id:"pickup",label:"Pickup Location",value:a,onChange:i,onLocationSelect:n=>P(n,!0),locations:[],icon:e.jsx(k,{className:"h-4 w-4 text-blue-600"}),inputRef:N}),e.jsx(S,{type:"button",variant:"outline",size:"icon",className:"mx-auto flex rounded-full",onClick:J,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx(I,{id:"destination",label:"Destination",value:t,onChange:o,onLocationSelect:n=>P(n,!1),locations:[],icon:e.jsx(k,{className:"h-4 w-4 text-red-600"}),inputRef:A})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{className:"text-lg",children:"Choose Ride Type"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:V.map(n=>e.jsx(pe,{option:n,isSelected:l===n.id,onSelect:m,rideTypesData:C.current},n.id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(b,{className:"text-lg flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"Payment Method"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{id:"payment-method",checked:d==="card",onCheckedChange:n=>M(n?"card":"cash")}),e.jsx(b,{htmlFor:"payment-method",className:"cursor-pointer",children:d==="card"?"Credit Card":"Cash"})]})]}),e.jsxs(S,{type:"submit",className:"w-full",size:"lg",disabled:!s||!c,children:[e.jsx(B,{className:"mr-2 h-5 w-5"})," Request Ride Now"]})]})})]}),e.jsxs("div",{className:"space-y-6",children:[G&&e.jsx("p",{children:"Loading..."}),e.jsx(ue,{pickupLocation:a,destination:t,pickupCoords:c,destinationCoords:s,mapRef:p,routeData:[O?.data],onlineDrivers:$?.data}),e.jsx(he,{pickupLocation:a,destination:t,rideType:l,paymentMethod:d,rideOptions:V,rideData:C.current})]})]})]})})}export{we as default};
