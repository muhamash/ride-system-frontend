import{y as w,aa as B,ab as b,ac as C,B as P,r as d,a1 as U,j as e,K as k,N as O,Q as q,F as p,S as T,L as F,W as G,a5 as N}from"./index-DGVUP1Vm.js";import{B as M}from"./badge-DBNqoGck.js";import{S as R}from"./separator-yiYEwLkb.js";import{u as _}from"./hooks-BDlyH-v8.js";const a={AVAILABLE:"AVAILABLE",UNAVAILABLE:"UNAVAILABLE",SUSPENDED:"SUSPENDED",RIDING:"RIDING",APPROVED:"APPROVED",NOTAPPROVED:"UNDER_REVIEW"};function $(){const{data:n,isLoading:E}=w(),[j]=B(),[L]=b(),[v]=C(),I=P(),x=_(),{showToast:c}=G(),[t,l]=d.useState(n?.data?.driver?.driverStatus),[A,o]=d.useState([]),[u,m]=d.useState(null),[h,f]=d.useState(null),[D]=U();d.useEffect(()=>{n?.data?.driver?.driverStatus&&l(n.data.driver.driverStatus)},[n]);const g=async()=>{if(t!==a.AVAILABLE){o([]);return}try{m(null);const s=await j().unwrap();if(s?.data?.rides){const r=s.data.rides.map(i=>({id:i.id,passengerName:i.riderUserName,pickup:i.pickUpLocation.address,dropoff:i.dropOffLocation.address,fare:i.fare,status:i.status,distance:i.distanceInKm}));o(r.filter(i=>i.status==="REQUESTED"))}s?.data?.currentRide&&f(s.data.currentRide._id)}catch(s){s?.status===403?(l(a.RIDING),m(s?.data?.message||"You are currently on an ongoing ride."),o([])):m(s?.data?.message||"Failed to fetch ride requests.")}};d.useEffect(()=>{g()},[t]);const y=async()=>{if(!(t===a.NOTAPPROVED||t===a.RIDING))try{const s=await L().unwrap();c({message:"Driver status updated successfully!",type:"success"});const r=s?.data?.driverStatus??(t===a.AVAILABLE?a.UNAVAILABLE:a.AVAILABLE);l(r),r===a.AVAILABLE&&g()}catch(s){c({message:s?.data?.message||s.message,type:"error"})}finally{x(N.util.resetApiState())}},S=async s=>{try{const r=await v({id:s}).unwrap();c({type:"success",message:r?.data?.data?.message||"Ride accepted successfully!"}),l(a.RIDING),f(r?.data?.data?.acceptedRide?._id||null),I(`/ride/ride-info/${r?.data?.acceptedRide?._id}`)}catch(r){c({type:"error",message:r?.data?.message||r.message})}},V=async s=>{await D({id:s}),x(N.util.resetApiState()),c({type:"success",message:"Cancelled request!"}),o(r=>r.filter(i=>i.id!==s))};return E?e.jsx("p",{children:"Loading..."}):e.jsx("div",{className:"container mx-auto p-6 py-30",children:e.jsxs(k,{className:"shadow-md rounded-2xl",children:[e.jsxs(O,{className:"flex justify-between items-center",children:[e.jsx(q,{className:"text-2xl font-bold",children:"Driver Dashboard"}),e.jsx(p,{onClick:()=>window.location.reload(),variant:"outline",size:"sm",children:"Refresh"})]}),e.jsx(R,{}),e.jsxs(T,{className:"space-y-4 mt-4",children:[n&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("p",{children:["Name: ",n?.data?.name]}),e.jsxs("p",{children:["Email: ",n?.data?.email]}),e.jsxs("p",{children:["Driver Status: ",t]}),e.jsxs("p",{children:["User Status: ",n?.data?.isOnline?"ONLINE":"OFFLINE"]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("span",{children:"Status: "}),e.jsx(p,{variant:t===a.AVAILABLE?"default":"outline",onClick:y,disabled:t===a.NOTAPPROVED||t===a.RIDING||t===a.SUSPENDED,children:t===a.AVAILABLE?"Available":"Unavailable"})]})]}),e.jsx(R,{}),u&&e.jsx("p",{className:"text-red-500",children:u}),t===a.AVAILABLE&&A.length===0&&!u&&e.jsx("p",{className:"text-gray-500",children:"You are online and available. Please wait until a rider sends a request..."}),t===a.AVAILABLE&&A.map(s=>e.jsxs("div",{className:"flex justify-between items-center p-4 border rounded-lg shadow-sm bg-white",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:s.passengerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.pickup," → ",s.dropoff]}),e.jsxs("p",{className:"text-sm",children:["Fare: ৳",s.fare]}),s.distance!==void 0&&e.jsxs("p",{className:"text-sm",children:["Distance: ",s.distance.toFixed(2)," km"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{variant:"secondary",children:s.status}),e.jsx(p,{onClick:()=>S(s.id),children:"Accept"}),e.jsx(p,{variant:"destructive",onClick:()=>V(s.id),children:"Cancel"})]})]},s.id)),t===a.RIDING&&h&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-red-500",children:"You are currently riding!"}),e.jsx(F,{className:"bg-pink-200 px-4 py-3 rounded-md",to:`/ride/ride-info/${h}`,children:"View ongoing ride"})]}),t===a.UNAVAILABLE&&!u&&e.jsx("p",{className:"text-red-500",children:"You are currently unavailable. Toggle to Available to see ride requests."})]})]})})}export{$ as default};
