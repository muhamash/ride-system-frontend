import{c as C,j as e,F as A,x as b,z as B,r as d,a4 as P,a5 as U,a6 as k,a7 as O,Q as q,H as T}from"./index-B0lCFcsv.js";import{S as E}from"./separator-Cmg9_Ya0.js";import{f as M,g as G,h as _,d as F,r as j}from"./ride.api-DphwrQZr.js";import{u as Y}from"./hooks-B87JGVFV.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}]],z=C("badge",Q);function H({driverData:t,driverStatus:n,toggleAvailability:l}){return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("p",{children:["Name: ",t?.data?.name]}),e.jsxs("p",{children:["Email: ",t?.data?.email]}),e.jsxs("p",{children:["Driver Status: ",n]}),e.jsxs("p",{children:["User Status: ",t?.data?.isOnline?"ONLINE":"OFFLINE"]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("span",{children:"Status: "}),e.jsx(A,{variant:n===a.AVAILABLE?"default":"outline",onClick:l,disabled:[a.NOTAPPROVED,a.RIDING,a.SUSPENDED].includes(n),children:n===a.AVAILABLE?"Available":"Unavailable"})]})]})}function K({ride:t,onAccept:n,onCancel:l}){return e.jsxs("div",{className:"flex justify-between items-center p-4 border rounded-lg shadow-sm bg-white",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:t.passengerName}),e.jsxs("p",{className:"text-sm text-gray-700",children:[t.pickup," ",e.jsx("span",{className:"text-xl text-rose-700 px-2",children:"→"})," ",t.dropoff]}),e.jsxs("p",{className:"text-sm",children:["Fare: ৳",t.fare]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{variant:"secondary",children:t.status}),e.jsx(A,{onClick:()=>n(t.id),children:"Accept"}),e.jsx(A,{variant:"destructive",onClick:()=>l(t.id),children:"Cancel"})]})]})}const a={AVAILABLE:"AVAILABLE",UNAVAILABLE:"UNAVAILABLE",SUSPENDED:"SUSPENDED",RIDING:"RIDING",APPROVED:"APPROVED",NOTAPPROVED:"UNDER_REVIEW"};function X(){const{data:t,isLoading:n}=b(),[l]=M(),[I]=G(),[L]=_(),[D]=F(),y=B(),x=Y(),{showToast:o}=q(),[i,u]=d.useState(),[N,p]=d.useState([]),[m,f]=d.useState(null),[v,R]=d.useState(null);d.useEffect(()=>{t?.data?.driver?.driverStatus&&u(t.data.driver.driverStatus)},[t]);const h=d.useCallback(async()=>{if(i!==a.AVAILABLE){p([]);return}try{f(null);const s=await l().unwrap(),r=s?.data?.rides||[];console.log(r);const g=r.map(c=>({id:c.id,passengerName:c.riderUserName,pickup:c.pickUpLocation.address,dropoff:c.dropOffLocation.address,fare:c.fare,status:c.status,distance:c.distanceInKm}));p(g.filter(c=>c.status==="REQUESTED")),R(s?.data?.currentRide?._id||null)}catch(s){s?.status===403?(u(a.RIDING),f(s?.data?.message||"You are currently on an ongoing ride.")):f(s?.data?.message||"Failed to fetch ride requests."),p([])}},[l,i]);d.useEffect(()=>{h()},[i,h]);const S=async()=>{if(![a.NOTAPPROVED,a.RIDING,a.SUSPENDED].includes(i))try{const s=await I().unwrap();o({message:"Driver status updated successfully!",type:"success"});const r=s?.data?.driverStatus??(i===a.AVAILABLE?a.UNAVAILABLE:a.AVAILABLE);u(r),r===a.AVAILABLE&&h()}catch(s){o({message:s?.data?.message||s.message,type:"error"})}finally{x(j.util.resetApiState()),x(T.util.resetApiState()),window.location.reload()}},V=async s=>{try{const r=await L({id:s}).unwrap();o({type:"success",message:r?.data?.data?.message||"Ride accepted successfully!"}),u(a.RIDING),R(r?.data?.data?.acceptedRide?._id||null),y(`/ride/ride-info/${r?.data?.acceptedRide?._id}`)}catch(r){o({type:"error",message:r?.data?.message||r.message})}},w=async s=>{await D({id:s}),x(j.util.resetApiState()),o({type:"success",message:"Cancelled request!"}),p(r=>r.filter(g=>g.id!==s))};return n?e.jsx("p",{children:"Loading..."}):e.jsx("div",{className:"container mx-auto p-6 py-30",children:e.jsxs(P,{className:"shadow-md rounded-2xl",children:[e.jsxs(U,{className:"flex justify-between items-center",children:[e.jsx(k,{className:"text-2xl font-bold",children:"Driver Dashboard"}),e.jsx(A,{onClick:()=>window.location.reload(),variant:"outline",size:"sm",children:"Refresh"})]}),e.jsx(E,{}),e.jsxs(O,{className:"space-y-4 mt-4",children:[t&&e.jsx(H,{driverData:t,driverStatus:i,toggleAvailability:S}),e.jsx(E,{}),m&&e.jsx("p",{className:"text-red-500",children:m}),i===a.AVAILABLE&&N.length===0&&!m&&e.jsx("p",{className:"text-gray-500",children:"You are online and available. Please wait for a ride request..."}),i===a.AVAILABLE&&N.map(s=>e.jsx(K,{ride:s,onAccept:V,onCancel:w},s.id)),(i===a.RIDING||v)&&e.jsx("p",{className:"text-red-500",children:"You are currently riding!"}),i===a.UNAVAILABLE&&!m&&e.jsx("p",{className:"text-red-500",children:"You are currently unavailable. Toggle to Available to see ride requests."})]})]})})}export{a as DRIVER_STATUS,X as default};
